<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FAnToM: Picking Algorithm Graphics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="FAnToM-logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FAnToM
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">scientific visualization and analysis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">Picking Algorithm Graphics</div>  </div>
</div><!--header-->
<div class="contents">

<p>FAnToM allows algorithms to declare actions that take place, when graphic objects are selected or moved.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfantom_1_1ROI.html">fantom::ROI</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">an <a class="el" href="classfantom_1_1ROI.html" title="an ROI (Region of Interest) is a bounding box defined by two points in space.">ROI</a> (Region of Interest) is a bounding box defined by two points in space.  <a href="classfantom_1_1ROI.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>FAnToM allows algorithms to declare actions that take place, when graphic objects are selected or moved. </p>
<div class="fragment"><div class="line"><span class="comment">//TODO: we need a new interaction Tutorial here!</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor">#include &lt;fantom/algorithm.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fantom/graphics.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fantom/register.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacefantom.html">fantom</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace</span></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">class </span>PickingTutorialAlgorithm : <span class="keyword">public</span> <a class="code" href="classfantom_1_1VisAlgorithm.html">VisAlgorithm</a></div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">        std::unique_ptr&lt; Manipulator &gt; mManipulator;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="classfantom_1_1VisOutputs.html">VisOutputs</a> : <span class="keyword">public</span> <a class="code" href="classfantom_1_1VisOutputs.html">VisAlgorithm::VisOutputs</a></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="classfantom_1_1VisOutputs.html">VisOutputs</a>( fantom::VisOutputs::Control&amp; control )</div>
<div class="line">                : <a class="code" href="classfantom_1_1VisAlgorithm.html">VisAlgorithm</a>::<a class="code" href="classfantom_1_1VisOutputs.html">VisOutputs</a>( control )</div>
<div class="line">            {</div>
<div class="line">                addGraphics( <span class="stringliteral">&quot;marker&quot;</span> );</div>
<div class="line">            }</div>
<div class="line">        };</div>
<div class="line"> </div>
<div class="line">        PickingTutorialAlgorithm( InitData&amp; data )</div>
<div class="line">            : <a class="code" href="classfantom_1_1VisAlgorithm.html">VisAlgorithm</a>( data )</div>
<div class="line">        {</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">virtual</span> <span class="keywordtype">void</span> execute( <span class="keyword">const</span> <a class="code" href="classfantom_1_1Options.html">Algorithm::Options</a>&amp; <span class="comment">/*options*/</span>, <span class="keyword">const</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span>&amp; <span class="comment">/*abortFlag*/</span> )<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">        </span>{</div>
<div class="line">            mManipulator = getGraphics( <span class="stringliteral">&quot;marker&quot;</span> ).makeManipulator();</div>
<div class="line"> </div>
<div class="line">            mManipulator-&gt;setDragCallback( std::bind( &amp;PickingTutorialAlgorithm::move,</div>
<div class="line">                                                      <span class="keyword">this</span>,</div>
<div class="line">                                                      std::placeholders::_1,</div>
<div class="line">                                                      std::placeholders::_2,</div>
<div class="line">                                                      std::placeholders::_3,</div>
<div class="line">                                                      std::placeholders::_4 ) );</div>
<div class="line">            mManipulator-&gt;primitive().addSphere( <a class="code" href="group__math.html#gad8125119640f66e3b4101948fab706b8">Point3</a>(), 0.05, <a class="code" href="classfantom_1_1Color.html">Color</a>( 1.0, 1.0, 1.0 ) );</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="classfantom_1_1Tensor.html">Vector3</a> center()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">        </span>{</div>
<div class="line">            <a class="code" href="classfantom_1_1Tensor.html">Vector4</a> x = <a class="code" href="group__math.html#gac1b2034dd6e1afeef27f4f09ed42b8ec">Vector4</a>( 0.0, 0.0, 0.0, 1.0 ) * mManipulator-&gt;view().matrix();</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="group__math.html#ga6ee66d161ecedafef530a7e7d85c60d2">Vector3</a>( x[0] / x[3], x[1] / x[3], x[2] / x[3] );</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">void</span> move( <a class="code" href="classfantom_1_1Tensor.html">Point3</a> s0, <a class="code" href="classfantom_1_1Tensor.html">Vector3</a> s, <a class="code" href="classfantom_1_1Tensor.html">Point3</a> t0, <a class="code" href="classfantom_1_1Tensor.html">Vector3</a> t )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">double</span> d = ( t0 - s0 ) * ( t0 - s0 );</div>
<div class="line">            <span class="keywordflow">if</span>( d == 0.0 )</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="classfantom_1_1Tensor.html">Vector3</a> n = s - ( t0 - s0 ) * ( s * ( t0 - s0 ) ) / d;</div>
<div class="line">            <span class="keywordtype">double</span> m = ( n * ( center() - s0 ) ) / ( n * s );</div>
<div class="line">            mManipulator-&gt;view().translate( ( t0 - s0 ) + ( t - s ) * m );</div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classfantom_1_1AlgorithmRegister.html">AlgorithmRegister&lt; PickingTutorialAlgorithm &gt;</a> dummy( <span class="stringliteral">&quot;Tutorial/Picking&quot;</span>, <span class="stringliteral">&quot;Show a simple pickable graphic.&quot;</span> );</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p>When run, the example draws a simple glyph that can be dragged by the mouse. You need to select the graphics object in the GUI, and possibly zoom in on it.</p>
<div class="fragment"><div class="line">    <span class="keyword">class </span>PickingTutorialAlgorithm : <span class="keyword">public</span> VisAlgorithm</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">        std::unique_ptr&lt; Manipulator &gt; mManipulator;</div>
</div><!-- fragment --><p>Manipulators, just like graphic objects, should be declared as class members in order to tie their life-time to that of the algorithm. Manipulators are no entities in their own right, they require a graphics object. The original idea for manipulators is that these manipulators are small glyphs that are shown near an object and can deform that object. In this example the manipulator only moves itself. When a graphics object is selected, its manipulators become visible, and when it is deselected, the manipulators are hidden automatically.</p>
<div class="fragment"><div class="line">        PickingTutorialAlgorithm( InitData&amp; data )</div>
<div class="line">            : VisAlgorithm( data )</div>
<div class="line">        {</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">virtual</span> <span class="keywordtype">void</span> execute( <span class="keyword">const</span> Algorithm::Options&amp; <span class="comment">/*options*/</span>, <span class="keyword">const</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span>&amp; <span class="comment">/*abortFlag*/</span> )<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">        </span>{</div>
<div class="line">            mManipulator = getGraphics( <span class="stringliteral">&quot;marker&quot;</span> ).makeManipulator();</div>
<div class="line"> </div>
<div class="line">            mManipulator-&gt;setDragCallback( std::bind( &amp;PickingTutorialAlgorithm::move,</div>
<div class="line">                                                      <span class="keyword">this</span>,</div>
<div class="line">                                                      std::placeholders::_1,</div>
</div><!-- fragment --><p>The constructor initializes a graphics object with an manipulator. It then sets the callback for drag events. (If <code>bind()</code> and <code>placeholder</code> confuses you, re-read an introduction to std::function or boost::function.) The function that is called when the manipulator is dragged with the mouse must take four parameters: the first pair <code></code>(s0,s) describes the line <code>s0+m*s</code> that corresponds to the mouse position before the movement and the second pair <code></code>(t0,t) describes the line <code>t0+m*t</code> that corresponds to the mouse position after the movement. The points are in world coordinates.</p>
<div class="fragment"><div class="line">                                                      std::placeholders::_2,</div>
<div class="line">                                                      std::placeholders::_3,</div>
<div class="line">                                                      std::placeholders::_4 ) );</div>
<div class="line">            mManipulator-&gt;primitive().addSphere( <a class="code" href="group__math.html#gad8125119640f66e3b4101948fab706b8">Point3</a>(), 0.05, Color( 1.0, 1.0, 1.0 ) );</div>
<div class="line">        }</div>
</div><!-- fragment --><p>The glyph itself is a sphere. Like regular graphics objects, manipulators allow a graphics primitive hierarchy to which geometry can be added.</p>
<div class="fragment"><div class="line">        <a class="code" href="group__math.html#ga6ee66d161ecedafef530a7e7d85c60d2">Vector3</a> center() const</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="group__math.html#gac1b2034dd6e1afeef27f4f09ed42b8ec">Vector4</a> x = <a class="code" href="group__math.html#gac1b2034dd6e1afeef27f4f09ed42b8ec">Vector4</a>( 0.0, 0.0, 0.0, 1.0 ) * mManipulator-&gt;view().matrix();</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="group__math.html#ga6ee66d161ecedafef530a7e7d85c60d2">Vector3</a>( x[0] / x[3], x[1] / x[3], x[2] / x[3] );</div>
<div class="line">        }</div>
</div><!-- fragment --><p>This little helper function computes the current translation. Each graphics object and each manipulator has an own view. (A view is actually a transformation, the name is an an unfortunate accident). Using this view graphics and manipulators can be displaced, rotated, and scaled. See <code>View</code> for more details. Recall from your lecture on homogeneous coordinates that to obtain the translation part of a transform you just need to multiply the homogeneous point <code></code>(0,0,0,1) with the transformation matrix.</p>
<div class="fragment"><div class="line">        <span class="keywordtype">void</span> move( <a class="code" href="group__math.html#gad8125119640f66e3b4101948fab706b8">Point3</a> s0, <a class="code" href="group__math.html#ga6ee66d161ecedafef530a7e7d85c60d2">Vector3</a> s, <a class="code" href="group__math.html#gad8125119640f66e3b4101948fab706b8">Point3</a> t0, <a class="code" href="group__math.html#ga6ee66d161ecedafef530a7e7d85c60d2">Vector3</a> t )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">double</span> d = ( t0 - s0 ) * ( t0 - s0 );</div>
<div class="line">            <span class="keywordflow">if</span>( d == 0.0 )</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="group__math.html#ga6ee66d161ecedafef530a7e7d85c60d2">Vector3</a> n = s - ( t0 - s0 ) * ( s * ( t0 - s0 ) ) / d;</div>
<div class="line">            <span class="keywordtype">double</span> m = ( n * ( center() - s0 ) ) / ( n * s );</div>
</div><!-- fragment --><p>The member function <code>move()</code> of this example is called when the marker receives the drag event. It starts by testing whether start and end line are actually different and returns if they are not. The next three lines are a bit of linear algebra magic. A vector normal to the near plane of the viewing volume is constructed by orthogonalizing <code>s</code> against <code></code>(t0-s0). Then the parameter <code>m</code> is chosen so that the point <code>s0+m*s</code> lies in the same plane having normal <code>n</code> as the center of the manipulator. Finally, the intersection of the two lines given by <code>s0+m*s</code> and <code>t0+m*t</code> with that plane specifies the correct translation vector of the marker.</p>
<div class="fragment"><div class="line">            mManipulator-&gt;view().translate( ( t0 - s0 ) + ( t - s ) * m );</div>
<div class="line">        }</div>
</div><!-- fragment --><p>The only thing left to do is to adjust the view transformation. Because transformation changes trigger repaints in the GUI, you should aim to do just one transformation change for each mouse event, otherwise there will be flickering in the GUI. View transformations cascade: graphics transformations are global and manipulator transformations are local.</p>
<p>Not shown in this example is that each graphic object can set a simple function that is called when the graphic object is selected. Use <code>Graphics::setClickCallback()</code> for that purpose. </p>
</div><!-- contents -->
<div class="ttc" id="aclassfantom_1_1Color_html"><div class="ttname"><a href="classfantom_1_1Color.html">fantom::Color</a></div><div class="ttdoc">RGBA color.</div><div class="ttdef"><b>Definition:</b> math.hpp:1619</div></div>
<div class="ttc" id="agroup__math_html_ga6ee66d161ecedafef530a7e7d85c60d2"><div class="ttname"><a href="group__math.html#ga6ee66d161ecedafef530a7e7d85c60d2">fantom::Vector3</a></div><div class="ttdeci">Tensor&lt; double, 3 &gt; Vector3</div><div class="ttdoc">3-D vector</div><div class="ttdef"><b>Definition:</b> math.hpp:754</div></div>
<div class="ttc" id="aclassfantom_1_1AlgorithmRegister_html"><div class="ttname"><a href="classfantom_1_1AlgorithmRegister.html">fantom::AlgorithmRegister</a></div><div class="ttdoc">registers an algorithm at the kernel</div><div class="ttdef"><b>Definition:</b> algorithm.hpp:291</div></div>
<div class="ttc" id="aclassfantom_1_1VisAlgorithm_html"><div class="ttname"><a href="classfantom_1_1VisAlgorithm.html">fantom::VisAlgorithm</a></div><div class="ttdoc">base class of visualization algorithms</div><div class="ttdef"><b>Definition:</b> algorithm.hpp:203</div></div>
<div class="ttc" id="anamespacefantom_html"><div class="ttname"><a href="namespacefantom.html">fantom</a></div><div class="ttdoc">FAnToM API namespace.</div><div class="ttdef"><b>Definition:</b> main.dox:37</div></div>
<div class="ttc" id="aclassfantom_1_1Tensor_html"><div class="ttname"><a href="classfantom_1_1Tensor.html">fantom::Tensor&lt; double, 3 &gt;</a></div></div>
<div class="ttc" id="aclassfantom_1_1Options_html"><div class="ttname"><a href="classfantom_1_1Options.html">fantom::Options</a></div><div class="ttdoc">base class of options</div><div class="ttdef"><b>Definition:</b> options.hpp:119</div></div>
<div class="ttc" id="aclassfantom_1_1VisOutputs_html"><div class="ttname"><a href="classfantom_1_1VisOutputs.html">fantom::VisOutputs</a></div><div class="ttdoc">Visual outputs of algorithms.</div><div class="ttdef"><b>Definition:</b> VisOutputs.hpp:40</div></div>
<div class="ttc" id="agroup__math_html_gad8125119640f66e3b4101948fab706b8"><div class="ttname"><a href="group__math.html#gad8125119640f66e3b4101948fab706b8">fantom::Point3</a></div><div class="ttdeci">Tensor&lt; double, 3 &gt; Point3</div><div class="ttdoc">3-D point</div><div class="ttdef"><b>Definition:</b> math.hpp:769</div></div>
<div class="ttc" id="agroup__math_html_gac1b2034dd6e1afeef27f4f09ed42b8ec"><div class="ttname"><a href="group__math.html#gac1b2034dd6e1afeef27f4f09ed42b8ec">fantom::Vector4</a></div><div class="ttdeci">Tensor&lt; double, 4 &gt; Vector4</div><div class="ttdoc">4-D vector</div><div class="ttdef"><b>Definition:</b> math.hpp:757</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
